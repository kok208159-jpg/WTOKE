<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á€„á€«á€·á€á€­á€¯á€·á€”á€¾á€…á€ºá€¦á€¸á€›á€²á€· Memories Diary</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root { --pink: #db2777; --bg: #fff5f7; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .container { max-width: 1000px; margin: auto; }
        .header-section { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; text-align: center; }
        
        /* Date Picker Style */
        .date-selector { margin: 20px 0; padding: 15px; background: white; border-radius: 15px; border: 2px solid var(--pink); }
        input[type="date"] { padding: 10px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; }

        /* Content Layout */
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; } }

        /* Notepad Section */
        .notepad { background: #fffde7; padding: 20px; border-radius: 15px; border-left: 10px solid #fbc02d; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        textarea { width: 100%; height: 250px; border: none; background: transparent; font-size: 17px; line-height: 1.6; outline: none; resize: none; }

        /* Photo Section */
        .photo-viewer { background: white; padding: 20px; border-radius: 15px; min-height: 300px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .grid img { width: 100%; height: 140px; object-fit: cover; border-radius: 12px; transition: 0.3s; cursor: pointer; }
        .grid img:hover { transform: scale(1.05); }

        .btn { background: var(--pink); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h1 style="color: var(--pink);">ğŸŒ¹ á€„á€«á€·á€á€­á€¯á€·á€”á€¾á€…á€ºá€¦á€¸á€›á€²á€· á€¡á€™á€¾á€á€ºá€á€› á€”á€±á€·á€›á€€á€ºá€™á€»á€¬á€¸</h1>
        <button id="auth_btn" class="btn" onclick="handleAuthClick()">Google Photos á€á€»á€­á€á€ºá€†á€€á€ºá€™á€Šá€º</button>
    </div>

    <div class="date-selector">
        <label>ğŸ“… á€›á€€á€ºá€…á€½á€²á€›á€½á€±á€¸á€á€»á€šá€ºá€•á€« - </label>
        <input type="date" id="selected-date" onchange="updateContentByDate()">
    </div>

    <div class="main-content">
        <div class="notepad">
            <h3 id="note-heading">á€”á€±á€·á€…á€‰á€ºá€™á€¾á€á€ºá€á€™á€ºá€¸</h3>
            <textarea id="note-input" oninput="saveNoteByDate()" placeholder="á€’á€®á€”á€±á€·á€›á€²á€· á€¡á€•á€»á€±á€¬á€ºá€†á€¯á€¶á€¸á€¡á€á€»á€­á€”á€ºá€á€½á€±á€€á€­á€¯ á€›á€±á€¸á€á€¬á€¸á€•á€«..."></textarea>
            <p id="save-status" style="font-size: 12px; color: green; display: none;">á€á€­á€™á€ºá€¸á€†á€Šá€ºá€¸á€•á€¼á€®á€¸ âœ…</p>
        </div>

        <div class="photo-viewer">
            <h3>ğŸ“· á€‘á€­á€¯á€”á€±á€·á€€ á€“á€¬á€á€ºá€•á€¯á€¶á€™á€»á€¬á€¸</h3>
            <div id="photos_grid" class="grid">
                <p style="color: #999;">á€›á€€á€ºá€…á€½á€²á€›á€½á€±á€¸á€•á€¼á€®á€¸ á€•á€¯á€¶á€™á€»á€¬á€¸á€€á€­á€¯ á€€á€¼á€Šá€·á€ºá€›á€¾á€¯á€•á€«...</p>
            </div>
        </div>
    </div>
</div>

<script>
    const CLIENT_ID = '1043599242937-k8ogr0hv2gbqnil69bpoqkdakht2ruia.apps.googleusercontent.com';
    const SCOPES = 'https://www.googleapis.com/auth/photoslibrary.readonly';
    let tokenClient;
    let accessToken = null;

    // á€šá€”á€±á€·á€›á€€á€ºá€…á€½á€²á€€á€­á€¯ Default á€‘á€¬á€¸á€á€¼á€„á€ºá€¸
    document.getElementById('selected-date').valueAsDate = new Date();

    function initClient() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID, scope: SCOPES,
            callback: (resp) => { accessToken = resp.access_token; updateContentByDate(); }
        });
        updateContentByDate(); 
    }

    function handleAuthClick() { tokenClient.requestAccessToken(); }

    // á€›á€€á€ºá€…á€½á€²á€•á€¼á€±á€¬á€„á€ºá€¸á€á€­á€¯á€„á€ºá€¸ á€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€™á€Šá€·á€º function
    function updateContentByDate() {
        const date = document.getElementById('selected-date').value;
        document.getElementById('note-heading').innerText = "ğŸ“ " + date + " á á€™á€¾á€á€ºá€á€™á€ºá€¸";
        
        // á€™á€¾á€á€ºá€…á€¯á€€á€­á€¯ Load á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
        const savedNote = localStorage.getItem('note_' + date);
        document.getElementById('note-input').value = savedNote || "";

        // á€“á€¬á€á€ºá€•á€¯á€¶á€™á€»á€¬á€¸á€€á€­á€¯ Load á€œá€¯á€•á€ºá€á€¼á€„á€ºá€¸
        if (accessToken) fetchPhotosByDate(date);
    }

    function saveNoteByDate() {
        const date = document.getElementById('selected-date').value;
        const content = document.getElementById('note-input').value;
        localStorage.setItem('note_' + date, content);
        
        const status = document.getElementById('save-status');
        status.style.display = 'block';
        setTimeout(() => status.style.display = 'none', 1000);
    }

    async function fetchPhotosByDate(dateStr) {
        const parts = dateStr.split('-'); // [YYYY, MM, DD]
        const filters = {
            "filters": {
                "dateFilter": { "dates": [{ "year": parts[0], "month": parts[1], "day": parts[2] }] }
            }
        };

        const res = await fetch('https://photoslibrary.googleapis.com/v1/mediaItems:search', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${accessToken}`, 'Content-Type': 'application/json' },
            body: JSON.stringify(filters)
        });
        const data = await res.json();
        const grid = document.getElementById('photos_grid');
        grid.innerHTML = data.mediaItems ? data.mediaItems.map(item => `<img src="${item.baseUrl}=w400">`).join('') : '<p>á€‘á€­á€¯á€”á€±á€·á€€ á€›á€­á€¯á€€á€ºá€‘á€¬á€¸á€á€±á€¬ á€•á€¯á€¶á€™á€›á€¾á€­á€•á€«á‹</p>';
    }

    window.onload = initClient;
</script>

</body>
</html>
